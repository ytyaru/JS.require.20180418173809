# 拡張

マークダウンのパースを拡張したい。

## 方針

* プレーンテキストで見やすい状態を維持できる範囲
* 自然言語が主体であること

### 課題

* 埋め込みデータをどうするか
    * データ構造
        * list
        * tree
        * graph
    * 表現
        * chart, diagram, mindmap, UML, logicTree, ...
    * audio, video, object, embed

## HTML5要素

http://www.htmq.com/html5/

## 候補

* `<kbd>`
* `<ruby>`
* `<time>`
* `<cite>` 作品
* `<var>` 変数
* `<samp>` プログラム出力結果

HTML5|説明
-----|----
`<kbd>`|ユーザ入力。キーボード, 音声入力, メニュー選択
`<samp>`|プログラム出力結果
`<var>`|変数。`<code>`内で使用。(不要?)
`<time>`|時間
`<cite>`|作品
`<ruby>`|振り仮名

* 外部読込
    * .csv, .tsv: `<table>`
    * .py, sh, ...: `<pre><code>`
    * .tree: `<ul><li>`
    * .menu: `<menu>` (テキストファイルの内容は`.tree`と同様で改行とインデント区切り)
    * Markdownでどう表現させるのがいいか
        * `{include path.ext}`
            * 拡張子によって最適な表示形式にする
* データ構造
    * `<li>`
        * 手順
        * なぜなぜ分析
        * パンくずリスト (階層位置)
        * メニュー（横）
        * 複数行
            * テキスト
            * HTML要素
    * `<table>`
        * 外部読込
            * tsv, csvから読み込める
        * `<caption>`
        * `<td>`
            * 複数行可
            * 任意の要素可(`<ul><li>`, `<pre><code>`)
        * `<th>`
            * ヘッダが横にある表
            * ヘッダが行と列の先頭や末尾に設定できる
            * ヘッダが一定間隔の行や列に設定できる
        * 複雑なUI化
            * 並べ替え(sort)
            * 絞り込み(filter)
            * ページ(page)
            * スクロール(scroll)
    * 木構造
        * ファイルツリーを表す表示が欲しい
            * `<ul class="file"><li>`で可能か
            * ディレクトリの開閉をするなら`<details>`?
            * jsライブラリを使ってまでやりたくない
            * `\`\`\`filesystem`のようにブロック構文にする？
        * 種類
            * filesystem
            * グループ化 (左右も使ってblock表示(段組))
            * マインドマップ (4方向よりも多く)
            * 樹形図
                * ロジックツリー (左から右へ)
                * 樹形図
    * 関係図(Network)
        * N-Triple
* `<form>`
    * `<input>`
        * `- []`: チェックボックス (`- [x]`)
        * `- ()`: ラジオボタン (`- (x)`)
        * `- [(placeholder)]`, `- [init text]`
            * type='': hidden, text, search, tel, url, email, password, datetime, date, month, week, time, datetime-local, number, range, color, checkbox, radio, file, submit, image, reset, button
            * (flag): autofocus, required, multiple
            * placeholder=''
            * pattern=''
            * min, max, step
            * autocomplete='on': `<datalist><optgroup><option value=''>`
    * `<textarea>`
    * `<keygen>`
    * `<output>`
    * `<progress>`
    * `<meter>`
* チャート、グラフ、ダイアグラム、マインドマップ、UML
    * markdownでやるべきではない?
        * 外部データを読み込んでやるべき?
    * https://qiita.com/ka215/items/a709665cb34c505ccf1f
* メタデータ
    * `<header>`, 
        * `<time>`
        * categoly, tag, 文書タイプ(成果報告、手順書まとめ,...)
        * 関連URL
            * 前提ページ
    * `<footer>`
        * 関連URL
            * 続きページ
* コンテンツ
    * `<audio>`
    * `<video>`

## kbd, samp の併用

HTML5|概要
-----|----
`<kbd>A</kbd>`|Aキー入力
`<kbd>A|B</kbd>`|AまたはBキー入力
`<kbd><kbd>Ctrl</kbd>+<kbd>A</kbd></kbd>`|Ctrl + A キー入力
`<kbd><samp>メニュー項目</samp></kbd>`|システムによって出力された何かを操作させるとき
`<samp><kbd>入力内容</kbd></samp>`|システムによって返された入力内容

AsciiDocでは以下。

```asciidoc
kbd:[Ctrl+T]
```

### pre, samp, kbd の併用

```html
<pre>
<samp>
名前と住所を入力してください。
  名前: <kbd>山田</kbd>
  住所: <kbd>日本</kbd>

私の名前は<kbd>山田</kbd>です。
<kbd>日本</kbd>に住んでいます。
</samp>
</pre>
```

これをmarkdownで表すならどうすべきか？ 表す必要があるか？


```markdown
\`\`\`samp
名前と住所を入力してください。
  名前: [[山田]]
  住所: [[日本]]

私の名前は[[山田]]です。
[[日本]]に住んでいます。
\`\`\`

```

### キーボード入力方法

名前|en|表記|説明
----|--|----|----
押す、押し放す|press|`[A]`|同一のキーを押下してから離すまでの工程。マウスでいうクリック。
押す、押下する|down|`[A]+`,`[A]_`|キーを押下する
放す、離す|up|`-[A]`,`[A]‾`|押下しているキーを離す(後述のchainと被る)
押し放すor押下する|press-or-down,chain|`[A]-`|キーを押下または押し離す（一度押下した後は押したままでも離されてもどちらでもいい）
連押し|rep,repeat,continue,high-speed,fast|`[[A]*2]`,`[A(2)]`,`[A^2]`,`[A ..10ms][A]+`|同一キーを高速で2回押す `*`は順不同押下押しと被る
順押し|seq,sequence|`[[A][B]]`,`[[A],[B]]`,`[A,B]`|複数のキーを順にpressする
長押し|long-time|`[[A]1s]`,`[A(1s)]`,`[A 1s]`,`[A 0.2s],`[A .2s]`,`[A 200ms]`|最低でも指定した時間downする
速押し|long-time|`[[A]..1s]`,`[A(..1s)]`,`[A ..1s]`,`[A -1s],`[A ~1s]`,`[A+ ~1s]`,`[A]+~1s`|指定時間以内に行う
溜め押し|term|`[A 1-2s]`, `[A 1~2s]`, `[A 1.3..1.7s]`, `[A 1.5+-.2s]`|一定時間downしたあとに離す
同時押し|sync|`[[A]=[B]]`,`[A=B]`,`[A=B=C]`,`[=A,B,C]`|2つ以上のキーを同時に押す
順押下(押下押し)|seq-down|`[[A]+[B]]`,`[A+B]`,`[A+B+C]`,`[+A,B,C]`|あるキーをdown中に別のキーを押下する
順不同押下押し|hold|`[[A]*[B]]`,`[A*B]`,`[A*B*C]`,`[*A,B,C]`,`[[A]:[B]:[C]]`,`[A:B:C]`|順不同の複数押下。
どれか||`[A|B]`|`|`で区切ったどれかの入力。
待ち押下|wait-down|`[A]_1s]`|文字入力における長押しの挙動。一定時間以内ならイベントは一回のみ発火するが時間以降は連続発火
待ち放す|wait-up|`[A]‾1s]`|

文字種が少なくて重複してしまっているものが多々ある。文字種を増やせばメタ文字のエスケープがウザいことになる。

#### 要素

要素|説明
----|----
キー|対象キー
状態|キーの状態 [押下中|離している]
回数|キーパターンの繰り返し回数
時間|キー状態を維持すべき時間
発火持続|イベント発火（キー状態を保っている間ずっと|真になったとき一度だけ）

* コマンド発火条件
    * キー種
        * 状態
            * 押下中|解放
        * 回数
        * 時間
* 発火持続
    * 真になったとき一度だけ
    * キー状態を保っている間ずっと
        * 待機
            * 開始まで指定時間待つ
        * 頻度
            * できるだけ多く
            * 一定間隔
        * 回数
            * 無制限
            * 指定した上限回数まで
            * 指定した下限回数以上

#### 用途

* 格闘ゲームなどではキーを押下するタイミングによってコマンド入力する
* vimなどではモード切替によってキーバインディングを変更している

ほかにも複合的なものが不足している。

表記|説明
----|----
`[[A=B]^2]`|AとBを同時に押すのを2回高速で。
`[[A 2s][B]]`|Aを2秒以上押したあとにBを押す
`[[A]+[B 2s]-[A]]`|Aを押下中にBを2秒以上押下したあとにAを離す
`[[A+B+C]~2s]`,`[[A_B_C_]~2s]`|A,B,Cを順に2秒以内で押下する
`[[A,B,C]~2s]`|A,B,Cを順に2秒以内で押し放す
`[[A-B-C]~2s]`,`[[A+B+C]*~2s]`,`[[A,B,C]*~2s]`,`[[[A]-[B]-[C]]~2s`|A,B,Cを順に2秒以内で押下または押し離す(格ゲー風)
`[[A ~50ms]-[B ~50ms]-[C ~50ms]]`,`[[A-B-C](~50ms)]`|A,B,Cを順に押下または押し離す。このとき各キーは50ms以内に離さねばならない。
`[[A ~10ms]-[B ~20ms]-[C ~30ms]]`|A,B,Cを順に押下または押し離す。このときA,B,Cの各キーはそれぞれ、10,20,30ms以内に離さねばならない。
`[A+-B-A]`,`[A_B-A‾]`|Aを押下したままBを押下または押し離したあとにAを離す

#### セパレータ

表記パターン|
------------|
[A B C]|
[A,B,C]|順押し。順に押して離すと発火
[A+B+C+]|順押下。順に押し下げると発火
[A*B*C*]|順不同押下。順序に関わらずすべてのキーを押下すると発火
[A-B-C-]|順序あるが一度押下すれば押したままでも離してもどちらでもいい。
[A/B/C/]|
[A:B:C:]|順不同押下。順序に関わらずすべてのキーを押下すると発火
[A.B.C.]|
[A_B_C_]|順押下。順に押し下げると発火
[A|B|C]|
[A&B&C]|

### markdownでどう書くか

#### 案1

markdown|例
--------|--
`{kbd *}`|`{kbd Ctrl+A}`, `{kbd.vim yy}`, {kbd.vim dD}`
`{time *}`|`<time datetime='2000-01-02 12:34:56.789+0900'>` https://www.w3.org/TR/html5/text-level-semantics.html#the-time-element
`{var *}`|
`{samp *}`|
`{kbd.samp *}`|
`\`\`\`samp`|`\`\`\``で終了。`<pre><samp>`を表す
`{cite *}`|`{cite 表示名}`
`{cite.a *}`|`{cite.a 表示名 URL title属性値`
`{ruby *}`|`{ruby 漢字|かん|じ}`

* 長所: 多様な要素に統一した表記で対応できる。
* 短所: プレーンテキストで表示したときに見づらい(markdownの特性が喪失する)

#### 案2

* `<kbd>*</kbd>`
    * `[*]`: a要素の表記と被る
        * `[ Ctrl + A ]`
            * `[]`中の最初と最後にスペースを開けたもののみ`<kbd>`とすれば被りにくい？
                * `Caps Lock`, `Prt Sc`などキー名にスペースがあるものは？
                    * スペース自体は`Space`と表記する
    * `~*~`, `%*%`
        * `~Ctrl+A~`, `%Ctrl+A%`
    * `[[*]]`: 冗長。markdown-it-kbd式。
        * `<kbd><kbd>Ctrl</kbd>+<kbd>A</kbd></kbd>`のようにネストできない問題
            * `[[[[Ctrl]]+[[A]]]]`
        * `[[ Ctrl + A ]]`
    * `{*}`: でんでんマークダウンの`<ruby>`と被る
    * `{kbd *}`: 冗長。HTMLと大差ない
    * `kbd:[*]`: 冗長。AsciiDoc記法。
* Type
    * Windows: `Ctrl + A`など
    * Vim: `yy`, `mode:visual`
    * Emacs: `^X`(Ctrl+X)など
    * 各ゲー等:
        * `A+B` A+Bボタン同時押し
        * `B(長押し)`

#### 案9

AsciiDocにする。

https://asciidoclive.com/edit/scratch/1

markdownより冗長だが多機能。









## 複数行

`<li>`, `<td>`に複数行テキストや複数行のHTML要素を入れたい。

HTMLならできるが、Markdownでどう表現するか。`a`タグの属性値を外出しする記法が参考になりそう。

### a

```markdown
[some]について。

[some]: http://...
```

### li

#### inline bad

```markdown
# 手順

1. エディタを開く
1. 以下のようなコードを書く
\`\`\`
some code 1.
some code 2.
\`\`\`
1. 実行する
```

順序の番号が途切れてしまう。

#### inline

```markdown
# 手順

1. エディタを開く
1. 以下のようなコードを書く
+
\`\`\`
some code 1.
some code 2.
\`\`\`
1. 実行する
```

AsciiDocだと`+`で連結できる。

#### 外だし記法

a要素の外だし記法を参考に考えてみた。

```markdown
# 手順

1. エディタを開く
1. 以下のようなコードを書く{1}
1. 実行する

{1}
    \`\`\`
    some code 1.
    some code 2.
    \`\`\`
```

##### 名前省略

表記された順序で定義する。

```markdown
# 手順

1. エディタを開く
1. 以下のようなコードを書く{}
1. 実行する
1. 複数行の何か{}

{}
    \`\`\`
    some code 1.
    some code 2.
    \`\`\`
{}
    * item1
    * item2
```

##### ネストできない?

```markdown
# 手順

1. エディタを開く
1. 以下のようなコードを書く{}
1. 実行する

{}
    \`\`\`
    some code 1.
    some code 2.
    \`\`\`
    {}
{}
    * item1
    * item2
```

非常にわかりづらい。


##### わかりやすくネストするなら？

どんな記法がいいか？


```markdown
# 手順

1. エディタを開く
1. 以下のようなコードを書く
    \`\`\`
    some code 1.
    some code 2.
    \`\`\`
    * item
        * item
    A|B
    -|-
    a|* B
      * BB
    A|* A
      * AA
1. 実行する

{}
    {}
{}
    * item1
    * item2
```

